##########################################################################
#
# The Prince and the Thane manteinance events - written by idib816 and Wiz
#
##########################################################################

namespace = manteinance

character_event = {
    id = manteinance.1
    desc = "I have too many warrior traits!"
    picture = GFX_evt_throne_room
	
	is_triggered_only = yes
    
    trigger = {
        OR = {
		    AND = {
			    trait = poor_warrior
			    trait = trained_warrior
			}
		    AND = {
			    trait = poor_warrior
			    trait = skilled_warrior
			}
		    AND = {
			    trait = poor_warrior
			    trait = master_warrior
			}
		    AND = {
			    trait = skilled_warrior
			    trait = trained_warrior
			}
		    AND = {
			    trait = skilled_warrior
			    trait = master_warrior
			}
		    AND = {
			    trait = master_warrior
			    trait = trained_warrior
			}
		}
    }
	
	mean_time_to_happen = {
		years = 10	
	}

    option = {
        name = "Ok"
		if = {
		    limit = {
			    trait = poor_warrior
			    trait = trained_warrior
			}
			remove_trait = poor_warrior
		}
		if = {
		    limit = {
			    trait = poor_warrior
			    trait = skilled_warrior
			}
			remove_trait = poor_warrior
		}
		if = {
		    limit = {
			    trait = poor_warrior
			    trait = master_warrior
			}
			remove_trait = poor_warrior
		}
		if = {
		    limit = {
			    trait = skilled_warrior
			    trait = trained_warrior
			}
			remove_trait = trained_warrior
		}
		if = {
		    limit = {
			    trait = skilled_warrior
			    trait = master_warrior
			}
			remove_trait = skilled_warrior
		}
		if = {
		    limit = {
			    trait = master_warrior
			    trait = trained_warrior
			}
			remove_trait = trained_warrior
		}
    }
}

character_event = {
    id = manteinance.2
    desc = "I can no longer lead the Karaites, not being of their religion"
    picture = GFX_evt_throne_room
    border = GFX_event_normal_frame_religion
	
	is_triggered_only = yes
	
	only_rulers = yes
    only_men = yes
    
    trigger = {
        has_landed_title = d_exilarch 
        NOT = { religion = karaite }
    }
	
	mean_time_to_happen = {
		years = 10	
	}

    option = {
        name = "Ok"
		d_exilarch = {
			destroy_landed_title = THIS
		}
    }
}

character_event = {
	id = 1190038
	desc = "The court's master of arms tested my fighting prowess today"
	
    only_men = yes
	min_age = 20
		
	trigger = {
		is_female = no
		age = 14
		NOT = { 
		    OR = {
			    trait = poor_warrior
				trait = trained_warrior
				trait = skilled_warrior
				trait = master_warrior
			}
		}
	}
		
	
	
	mean_time_to_happen = {
		months = 1	
	}
	
	
	immediate = {
		if = {
    		limit = { 
			    NOT = { martial = 6 }
			}
			random_list = {
			    70 = { add_trait = poor_warrior }
			    20 = { add_trait = trained_warrior }
			    9 = { add_trait = skilled_warrior }
			    1 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 6
			    NOT = { martial = 8 }
			}
			random_list = {
			    40 = { add_trait = poor_warrior }
			    30 = { add_trait = trained_warrior }
			    20 = { add_trait = skilled_warrior }
			    10 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 8
			    NOT = { martial = 10 }
			}
			random_list = {
			    30 = { add_trait = poor_warrior }
			    35 = { add_trait = trained_warrior }
			    25 = { add_trait = skilled_warrior }
			    10 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 10
			    NOT = { martial = 12 }
			}
			random_list = {
			    25 = { add_trait = poor_warrior }
			    30 = { add_trait = trained_warrior }
			    30 = { add_trait = skilled_warrior }
			    15 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 12
			    NOT = { martial = 14 }
			}
			random_list = {
			    15 = { add_trait = poor_warrior }
			    25 = { add_trait = trained_warrior }
			    40 = { add_trait = skilled_warrior }
			    20 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 14
			    NOT = { martial = 16 }
			}
			random_list = {
			    10 = { add_trait = poor_warrior }
			    20 = { add_trait = trained_warrior }
			    40 = { add_trait = skilled_warrior }
			    30 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 16
			    NOT = { martial = 18 }
			}
			random_list = {
			    5 = { add_trait = poor_warrior }
			    15 = { add_trait = trained_warrior }
			    35 = { add_trait = skilled_warrior }
			    45 = { add_trait = master_warrior }
			}
		}
		if = {
    		limit = { 
			    martial = 18
			}
			random_list = {
			    5 = { add_trait = poor_warrior }
			    10 = { add_trait = trained_warrior }
			    30 = { add_trait = skilled_warrior }
			    55 = { add_trait = master_warrior }
			}
		}
	}

	option = {
		name = "Apparently I'm a poor fighter"
		trigger = { trait = poor_warrior }
	}
	
    option = {
		name = "Apparently I'm an average fighter"
		trigger = { trait = trained_warrior }
	}
	
	option = {
		name = "Apparently I'm a skilled fighter"
		trigger = { trait = skilled_warrior }
	}
	
	option = {
		name = "Apparently I'm a great fighter"
		trigger = { trait = master_warrior }
	}
}

# Templar manteinance
character_event = {
	id = manteinance.3
	desc = "I'm not supposed to have this trait"
	picture = GFX_evt_knight1
		
		is_triggered_only = yes

        only_men = yes
        min_age = 14
	
	trigger = {
		ai = yes 
		OR = {
            trait = templar
            trait = templar_leader 
		}
        OR = {
            NOT = { religion = catholic }
            is_female = yes
		    NOT = { age = 14 }
		}	
	}
	
	mean_time_to_happen = {
		years = 100
	}
	
	option = {
		name = "That's right"
		remove_trait = templar
        remove_trait = templar_leader			
	}
}

# Martial
character_event = {
	id = manteinance.4
	desc = "I'm not supposed to have this trait"
	picture = GFX_evt_knight1
	is_triggered_only = yes

    only_women = yes
    min_age = 14
	
	trigger = {
        is_female = yes
		OR = {
            trait = war_hero
			trait = poor_warrior
			trait = skilled_warrior
			trait = trained_warrior
			trait = master_warrior
		}
	}
	
	mean_time_to_happen = {
		years = 100
	}
	
	option = {
		name = "That's right"
		remove_trait = war_hero		
		remove_trait = poor_warrior
		remove_trait = skilled_warrior		
		remove_trait = trained_warrior		
		remove_trait = master_warrior		
	}
}

# Templar manteinance 2
character_event = {
	id = manteinance.5
	desc = "I'm not supposed to have two identical traits"
	picture = GFX_evt_knight1
    is_triggered_only = yes
	
	trigger = {
        trait = templar
        trait = templar_leader	
	}
	
	mean_time_to_happen = {
		years = 100
	}
	
	option = {
		name = "That's right"
        remove_trait = templar_leader			
	}
}

## Men cannot be pregnant
character_event = {
	id = manteinance.6
	desc = "I'm a pregnant man"
	picture = "GFX_evt_brothel"
    only_men = yes
	is_triggered_only = yes

	trigger = {
        trait = pregnant	
	}

	mean_time_to_happen = {
		years = 100
	}

	option = {
		name = "This isn't right"
        remove_trait = pregnant
    }
}

#Ducal assignment
character_event = {
	id = manteinance.7
		
	is_triggered_only = yes
	
	trigger = {
		ai = yes
		primary_title = { higher_tier_than = DUKE }
		OR = {
			num_of_duke_titles = 4	
			AND = {
				NOT = { 
					any_demesne_title = {
						tier = duke
						is_titular = yes
					}
				}
				num_of_duke_titles = 3
			}
			AND = {
				primary_title = { has_law = succ_feudal_elective }
				num_of_duke_titles = 2
			}
		}
		OR = {	
			any_realm_lord = {
				religion = ROOT
				is_liege_or_above = ROOT			
				any_demesne_title = {
					tier = COUNT					
					location = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}	
					}
				}				
			}
			any_demesne_title = {
				tier = COUNT
				location = {
					duchy = {
						NOT = { title = d_sunni }
						NOT = { title = d_shiite }
						holder_scope = { character = ROOT }
						NOT = {
							ROOT = {
								capital_scope = {
									duchy = { title = PREVPREVPREV }
								}									
							}
						}
					}
				}
			}			
		}
	}
		
	desc = "AI_EVENT"
	
	mean_time_to_happen = {
		years = 1
	}
	
	option = {
		name = "OK"
		hidden_tooltip = {
			#try to give it to a count with their capital in the duchy
			#give it to lords with good relationship + same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#give it to lords with good relationship + same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			#give to lords with which we have a decent relationship
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#try to give it to a count who has a province in the duchy
			#same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			#by relation
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			#if we have a large demesne, try to give it to a randomly generated character along with a count title in the duchy that we hold
			random_demesne_title = {
				limit = {
					tier = COUNT
					ROOT = { NOT = { demesne_efficiency = 1.5 } }
					NOT = { has_global_flag = duchy_granted }
					location = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}	
					}
				}	
				ROOT = {
					create_random_steward = {
						random_traits = yes
						dynasty = random
						female = no
					}
					new_character = {					
						ROOT = {
							random_demesne_title = {
								limit = {
									tier = COUNT
									location = {
										duchy = {
											NOT = { title = d_sunni }
											NOT = { title = d_shiite }						
											holder_scope = { character = ROOT }
											NOT = {
												ROOT = {
													capital_scope = {
														duchy = { title = PREVPREVPREV }
													}									
												}
											}
										}
									}
								}
								location = {
									set_province_flag = this_duchy
								}
							}
							random_demesne_province = {
								limit = {
									has_province_flag = this_duchy
								}
								county = {
									grant_title = PREVPREVPREV
								}
								duchy = {
									grant_title = PREVPREVPREV
								}
								clr_province_flag = this_duchy
							}
						}
						set_defacto_liege = ROOT
					}
				}
				set_global_flag = duchy_granted
			}
			#give it to anyone with their capital in the duchy
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					capital_scope = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					duchy = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#anyone with a province in the duchy
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = COUNT
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			#if we have at least half our demesne size in provinces, try to give it to a randomly generated character along with a count title in the duchy that we hold
			random_demesne_title = {
				limit = {
					tier = COUNT
					ROOT = { NOT = { demesne_efficiency = 2.0 } }
					NOT = { has_global_flag = duchy_granted }
					location = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}	
					}
				}	
				ROOT = {
					create_random_steward = {
						random_traits = yes
						dynasty = random
						female = no
					}
					new_character = {					
						ROOT = {
							random_demesne_title = {
								limit = {
									tier = COUNT
									location = {
										duchy = {
											NOT = { title = d_sunni }
											NOT = { title = d_shiite }						
											holder_scope = { character = ROOT }
											NOT = {
												ROOT = {
													capital_scope = {
														duchy = { title = PREVPREVPREV }
													}									
												}
											}
										}
									}
								}
								location = {
									set_province_flag = this_duchy
								}
							}
							random_demesne_province = {
								limit = {
									has_province_flag = this_duchy
								}
								county = {
									grant_title = PREVPREVPREV
								}
								duchy = {
									grant_title = PREVPREVPREV
								}
								clr_province_flag = this_duchy
							}
						}
						set_defacto_liege = ROOT
					}
				}
				set_global_flag = duchy_granted
			}						
			#if all else fails, give it to any vassal that has land in the duchy
			#same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}	
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}	
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			#by relation
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}	
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}
			#anyone
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					culture = ROOT
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					culture_group = ROOT
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = duchy_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					any_demesne_title = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							duchy = {
								NOT = { title = d_sunni }
								NOT = { title = d_shiite }						
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											duchy = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						duchy = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = duchy_granted
			}	
			#give it away to random character, regardless of demesne size
			random_demesne_title = {
				limit = {
					tier = COUNT
					NOT = { has_global_flag = duchy_granted }
					location = {
						duchy = {
							NOT = { title = d_sunni }
							NOT = { title = d_shiite }						
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										duchy = { title = PREVPREVPREV }
									}									
								}
							}
						}	
					}
				}	
				ROOT = {
					create_random_steward = {
						random_traits = yes
						dynasty = random
						female = no
					}
					new_character = {					
						ROOT = {
							random_demesne_title = {
								limit = {
									tier = COUNT
									location = {
										duchy = {
											NOT = { title = d_sunni }
											NOT = { title = d_shiite }						
											holder_scope = { character = ROOT }
											NOT = {
												ROOT = {
													capital_scope = {
														duchy = { title = PREVPREVPREV }
													}									
												}
											}
										}
									}
								}
								location = {
									set_province_flag = this_duchy
								}
							}
							random_demesne_province = {
								limit = {
									has_province_flag = this_duchy
								}
								county = {
									grant_title = PREVPREVPREV
								}
								duchy = {
									grant_title = PREVPREVPREV
								}
								clr_province_flag = this_duchy
							}
						}
						set_defacto_liege = ROOT
					}
				}				
				set_global_flag = duchy_granted
			}			
			clr_global_flag = duchy_granted	
			character_event = { id = 110017 }
		}
	}
}

#Kingdom assignment
character_event = {
	id = manteinance.8
	is_triggered_only = yes
	
	trigger = {
		ai = yes
		tier = EMPEROR
		num_of_king_titles = 2
		any_realm_lord = {
			religion = ROOT
			culture_group = ROOT
			is_liege_or_above = ROOT			
			any_demesne_title = {
				tier = COUNT					
				location = {
					kingdom = {
						holder_scope = { character = ROOT }
						NOT = {
							ROOT = {
								capital_scope = {
									kingdom = { title = PREVPREVPREV }
								}									
							}
						}
					}	
				}
			}				
		}
	}
		
	desc = "EVTDESC110017"
	
	mean_time_to_happen = {
		years = 1
	}
	
	option = {
		name = "EVTOPTA110017"
		hidden_tooltip = {
			#try to give it to a duke with their capital in the kingdom
			#give it to lords with good relationship + same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#give it to lords with good relationship + same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#try to give it to a duke who has a province in the kingdom
			#same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}						
			#give it to anyone with their capital in the kingdom
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			#anyone with a province in the kingdom
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = DUKE
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			#try to give it to a duke with their capital in the kingdom
			#give it to lords with good relationship + same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#give it to lords with good relationship + same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = DUKE
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			#try to give it to a king who has a province in the kingdom
			#same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#same culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}					
			#give it to anyone with their capital in the kingdom
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = KING
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = KING
					}
					capital_scope = {
						kingdom = {
							holder_scope = { character = ROOT }
							NOT = {
								ROOT = {
									capital_scope = {
										kingdom = { title = PREVPREVPREV }
									}									
								}
							}
						}				
					}
				}
				capital_scope = {
					kingdom = {
						grant_title = PREVPREV
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			#anyone with a province in the kingdom
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					primary_title = {
						tier = KING
					}
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}						
			#if all else fails, give it to any vassal that has land in the kingdom
			#same culture
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}	
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			#culture group
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 50 }
					opinion = { who = ROOT value = 0 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}	
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 25 }
					opinion = { who = ROOT value = -25 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					culture_group = ROOT
					is_liege_or_above = ROOT
					reverse_opinion = { who = ROOT value = 0 }
					opinion = { who = ROOT value = -50 }
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			#anyone
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					culture = ROOT
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}			
			random_realm_lord = {
				limit = {
					NOT = { has_global_flag = kingdom_granted }
					religion = ROOT
					is_liege_or_above = ROOT
					culture_group = ROOT
					any_demesne_title = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
				}
				random_demesne_title = {
					limit = {
						tier = COUNT
						location = {
							kingdom = {
								holder_scope = { character = ROOT }
								NOT = {
									ROOT = {
										capital_scope = {
											kingdom = { title = PREVPREVPREV }
										}									
									}
								}
							}	
						}
					}
					location = {
						kingdom = {
							grant_title = PREVPREVPREV
						}
					}
				}
				set_defacto_liege = ROOT
				set_global_flag = kingdom_granted
			}						
			clr_global_flag = kingdom_granted	
			character_event = { id = 110029 }
		}
	}
}

# Remove claims
character_event = {
	id = manteinance.9
	desc = "AI_EVENT"
	
	is_triggered_only = yes
	
	trigger = {
		ai = yes
		NOT = { year = 1070 }
		NOT = { has_character_flag = claims_removed }
		OR = {
			has_claim = d_aquitaine
			has_claim = d_poitou
			has_claim = k_norway
			has_claim = e_russia
		}
	}
	
	mean_time_to_happen = {
	years = 10
	}
	
	option = {
		name = "OK"
		set_character_flag = claims_removed
		if = {
			limit = { has_claim = d_aquitaine }
			remove_claim = d_aquitaine
		}
		if = {
			limit = { has_claim = d_poitou }
			remove_claim = d_poitou
		}
		if = {
			limit = { has_claim = k_norway }
			remove_claim = k_norway
		}	
		if = {
			limit = { has_claim = e_russia }
			remove_claim = e_russia
		}		
	}
}